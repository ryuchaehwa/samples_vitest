# Pinia TDD

## TDD를 위한 Pinia

### 🎶 목표

- `Actions`를 실행하고 `State`의 변화 감지
- 스토어 내부의 로직은 블랙박스 테스트
- 외부에서 보이는 결과값만 확인

### ✅ 개요

- Pinia를 테스트 할 때는 개별 store를 하나의 단위로 취급
  - `구현이 어떻게 되었는가`보다, `실질적 행위`를 테스트 해야 되기 때문
  - Pinia의 내부 로직을 어떻게 개발하였는가는 TDD 진행의 목적에 부합한다고 보기 어렵고, 내부 로컬 함수와 외부 컴포넌트에서 사용하는 결과값은 크게 관련 없음
  - 내부 로직이 어떠하든 결과가 중요하기 때문에 pinia의 경우, store를 하나의 단위로 취급하여 블랙박스 테스트로 진행
  - 만약 단위 테스트를 진행할 거라면 store로 진행하는 것이 아닌, util로 진행
    - 스토어 내부 로직 단위 테스트: 특정 도메인에 종속적이고 상태를 변경하는 로직은 store action 테스트로 통합 진행
    - 스토어 내부 순수 함수 테스트: 복잡한 계산식, 날짜 포맷팅 등 상태와 무관하게 입력값 대비 출력값이 일정한 로직 -> 별도 utils.ts로 분리해서 독립적인 단위 테스트 진행

### 📍 테스트 과정

1. 초기화 및 설정

   - 스토어를 초기화 하고
   - 모킹에 필요한 툴(MSW등)을 준비 및 설정

2. `Actions` 호출

3. `state`나 `getters`의 변경된 상태 확인

### 📂 폴더 구조

- 도메인 중심 구조

```text
src/
├── stores/
│   ├── user/
│   │   ├── user.ts          # 스토어 정의
│   │   ├── user.spec.ts     # TDD 테스트 코드 (Vitest)
│   │   └── user.type.ts     # 타입 정의
├── api/
│   └── user.ts              # Axios 인스턴스 및 호출 함수
└── tests/
    └── setup.ts             # Vitest 전역 설정 (MSW 연결 등)
```

### ⁉️ 클로드 코드 표준화 진행 시 유의사항

- `이 Action을 실행했을 때 이런 State가 되어야 한다는 명세를 작성해줘` 등의 검증 영역을 명확히 할 것.
